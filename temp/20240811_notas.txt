Bom dia.

Estou trabalhando num aplica√ß√£o, desenvolvendo a mesma com codeignitor 4, e as views tem o bootstrap.

Voc√™ √© um m√©dico generalista que est√° me ajudando. 

Observe algumas coisas. N√≥s criamos um modelo: 

<?php

namespace App\Models;

use CodeIgniter\Model;

class PacienteModel extends Model
{
    protected $table = 'pacientes';
    protected $allowedFields = [
        'nome', 
		'data_nascimento', 
		'condicoes', 
		'alergias'		, 
		'medicacoes', 
		'cirurgias', 
		'historico_familiar', 
		'sintomas', 
		'duracao_sintomas', 
		'intensidade_sintomas', 
		'fatores', 
		'exames', 
		'resultados', 
		'diagnosticos', 
		'habitos_alimentares', 
		'atividade_fisica', 
		'alcool', 
		'tabaco', 
		'notas', 
		'plano_tratamento', 
		'proximas_consultas', 
		'consentimento'
    ];
}

N√≥s temos um controller:

<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index()
    {
        return view('formulario/informacoes_pessoais');
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $model->save($data);

        return redirect()->to('/formulario/historico_medico');
    }

    public function historicoMedico()
    {
        return view('formulario/historico_medico');
    }

    public function salvarHistoricoMedico()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $model->save($data);

        return redirect()->to('/formulario/sintomas_atuais');
    }

    // Continue com os outros m√©todos para cada etapa...
}

Aqui est√£o as rotas: 

<?php

use CodeIgniter\Router\RouteCollection;

/**
 * @var RouteCollection $routes
 */
$routes->get('/', 'Home::index');

$routes->get('/formulario', 'FormularioController::index');
$routes->get('/formulario/informacoes_pessoais', 'FormularioController::index');
$routes->post('/formulario/salvarInformacoesPessoais', 'FormularioController::salvarInformacoesPessoais');
$routes->get('/formulario/historico_medico', 'FormularioController::historicoMedico');
$routes->post('/formulario/salvarHistoricoMedico', 'FormularioController::salvarHistoricoMedico');
// Continue adicionando rotas para as outras etapas...

E minha view at√© o momento:

<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="/formulario/salvarInformacoesPessoais" method="post">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" required>
            </div>
            <!-- Outros campos... -->
            <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
        </form>
    </div>
</div>
<?= $this->endSection() ?>

A ideia √© trabalhar como um workflow onde cada form representa uma etapa.

O que voc√™ acha?


Seu modelo `PacienteModel` est√° bem estruturado para armazenar informa√ß√µes detalhadas sobre os pacientes. Para implementar um fluxo de trabalho (workflow) que permita preencher cada uma das telas pertinentes, voc√™ pode considerar as seguintes sugest√µes:

1. **Divis√£o do Formul√°rio em Etapas**:
   - **Dados Pessoais**: Nome, data de nascimento.
   - **Hist√≥rico M√©dico**: Condi√ß√µes, alergias, medica√ß√µes, cirurgias, hist√≥rico familiar.
   - **Sintomas Atuais**: Sintomas, dura√ß√£o dos sintomas, intensidade dos sintomas, fatores.
   - **Exames e Diagn√≥sticos**: Exames, resultados, diagn√≥sticos.
   - **Estilo de Vida**: H√°bitos alimentares, atividade f√≠sica, consumo de √°lcool e tabaco.
   - **Notas e Plano de Tratamento**: Notas, plano de tratamento, pr√≥ximas consultas, consentimento.

2. **Valida√ß√£o de Dados**:
   - Certifique-se de validar os dados em cada etapa antes de permitir que o usu√°rio avance para a pr√≥xima. Isso pode incluir verifica√ß√µes de campos obrigat√≥rios e formatos de dados.

3. **Navega√ß√£o entre Etapas**:
   - Implemente bot√µes de "Pr√≥ximo" e "Anterior" para permitir que o usu√°rio navegue entre as etapas do formul√°rio.
   - Considere salvar os dados parcialmente preenchidos em cada etapa para evitar perda de informa√ß√µes.

4. **Interface de Usu√°rio**:
   - Utilize uma barra de progresso ou indicadores de etapas para mostrar ao usu√°rio em qual parte do fluxo de trabalho ele est√°.
   - Mantenha a interface limpa e intuitiva, com instru√ß√µes claras para cada campo.

5. **Armazenamento e Recupera√ß√£o de Dados**:
   - Garanta que os dados sejam armazenados de forma segura no banco de dados.
   - Implemente funcionalidades para recuperar e editar fichas m√©dicas existentes.

Aqui est√° um exemplo de como voc√™ pode estruturar uma das etapas no seu controlador:

```php
namespace App\Controllers;

use App\Models\PacienteModel;

class PacienteController extends BaseController
{
    public function createStep1()
    {
        return view('paciente/step1');
    }

    public function storeStep1()
    {
        $pacienteModel = new PacienteModel();

        $data = [
            'nome' => $this->request->getPost('nome'),
            'data_nascimento' => $this->request->getPost('data_nascimento'),
        ];

        $pacienteModel->save($data);

        return redirect()->to('/paciente/step2');
    }

    // Adicione m√©todos para as outras etapas...
}
```

Essa abordagem modulariza o processo de preenchimento da ficha m√©dica, tornando-o mais gerenci√°vel e amig√°vel para o usu√°rio. Se precisar de mais detalhes ou tiver outras perguntas, estou aqui para ajudar! üòä


Vamos come√ßar com algo simples. Ajude-me.

<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="/formulario/salvarInformacoesPessoais" method="post">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" required>
            </div>
            <!-- Outros campos... -->
            <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
        </form>
    </div>
</div>
<?= $this->endSection() ?>

Eu gostaria que o bot√£o pr√≥ximo fique alinhado √† direita na p√°gina.
Deve haver mais um campo na tela, mostrando a idade do paciente, mas esse campo n√£o deve ser digit√°vel. A idade deve ser calculada depois que o usu√°rio digite a data de nascimento do paciente.
Pode me ajudar?

Claro, posso ajudar com isso! Vamos fazer as seguintes altera√ß√µes:

1. Alinhar o bot√£o "Pr√≥ximo" √† direita.
2. Adicionar um campo para mostrar a idade do paciente, que ser√° calculada automaticamente ap√≥s a inser√ß√£o da data de nascimento.

Aqui est√° o c√≥digo atualizado:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="/formulario/salvarInformacoesPessoais" method="post">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" required>
            </div>
            <div class="form-group">
                <label for="idade">Idade:</label>
                <input type="text" class="form-control" id="idade" name="idade" readonly>
            </div>
            <div class="form-group text-right">
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('data_nascimento').addEventListener('change', function() {
        var dataNascimento = new Date(this.value);
        var hoje = new Date();
        var idade = hoje.getFullYear() - dataNascimento.getFullYear();
        var mes = hoje.getMonth() - dataNascimento.getMonth();
        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });
</script>
<?= $this->endSection() ?>
```

### Explica√ß√£o das Altera√ß√µes:

1. **Alinhamento do Bot√£o**: Adicionei a classe `text-right` ao `div` que cont√©m o bot√£o "Pr√≥ximo" para alinh√°-lo √† direita.
2. **Campo de Idade**: Adicionei um campo de entrada para mostrar a idade do paciente, que √© somente leitura (`readonly`).
3. **C√°lculo da Idade**: Adicionei um script JavaScript que calcula a idade do paciente com base na data de nascimento inserida e atualiza o campo de idade automaticamente.

Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

Fonte: conversa com o Copilot, 11/08/2024
(1) github.com. https://github.com/mauriciopj/SGC/tree/d17a87f41953dec23fbdd1dc160ac18a1948ba79/Codigo_Fonte%2Fapplication%2Fviews%2FUsuarios%2Fcadastro_usuarios.php.
(2) github.com. https://github.com/fmmh10/Pandemic/tree/cd4fd0f5f9c0629d3e1840e1d6bf5b6369add557/ASW%2Fregister.php.
(3) github.com. https://github.com/danfigueiredo/SuriEmu/tree/a3e3b337f4748aa7a3c4c244322aafa78128bec6/tabela_orcamento.php.

---

Agora, n√≥s estamos dividindo a aplica√ß√£o assim:

1. **Divis√£o do Formul√°rio em Etapas**:
   - **Dados Pessoais**: Nome, data de nascimento.
   - **Hist√≥rico M√©dico**: Condi√ß√µes, alergias, medica√ß√µes, cirurgias, hist√≥rico familiar.
   - **Sintomas Atuais**: Sintomas, dura√ß√£o dos sintomas, intensidade dos sintomas, fatores.
   - **Exames e Diagn√≥sticos**: Exames, resultados, diagn√≥sticos.
   - **Estilo de Vida**: H√°bitos alimentares, atividade f√≠sica, consumo de √°lcool e tabaco.
   - **Notas e Plano de Tratamento**: Notas, plano de tratamento, pr√≥ximas consultas, consentimento.

E chegou o momento do hist√≥rico m√©dico.

a view de informacoes pessoais est√° assim: 

<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="/formulario/salvarInformacoesPessoais" method="post">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" required>
            </div>
            <div class="form-group">
                <label for="idade">Idade:</label>
                <input type="text" class="form-control" id="idade" name="idade" readonly>
            </div>
            <div class="form-group text-right">
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('data_nascimento').addEventListener('change', function() {
        var dataNascimento = new Date(this.value);
        var hoje = new Date();
        var idade = hoje.getFullYear() - dataNascimento.getFullYear();
        var mes = hoje.getMonth() - dataNascimento.getMonth();
        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });
</script>
<?= $this->endSection() ?>

E a view de historico m√©dico est√° assim:

<form action="/formulario/salvarHistoricoMedico" method="post">
    <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
    <textarea id="condicoes" name="condicoes"></textarea>
    <!-- Outros campos... -->
    <button type="submit">Pr√≥ximo</button>
</form>


Ent√£o vamos deixar no mesmo padr√£o das informa√ß√µes pessoais e vamos colocar os campos: Condi√ß√µes, alergias, medica√ß√µes, cirurgias, hist√≥rico familiar.

Essa view deve ter o bot√£o pr√≥ximo e o bot√£o voltar. o bot√£o voltar deve ficar na esquerda e o pr√≥ximo na direita.

Olha tamb√©m o controller:

<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index()
    {
        return view('formulario/informacoes_pessoais');
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $model->save($data);

        return redirect()->to('/formulario/historico_medico');
    }

    public function historicoMedico()
    {
        return view('formulario/historico_medico');
    }

    public function salvarHistoricoMedico()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $model->save($data);

        return redirect()->to('/formulario/sintomas_atuais');
    }

    // Continue com os outros m√©todos para cada etapa...
}

Ajude-me, por favor. Lembre-se, voc√™ √© um m√©dico generalista me ajudando, mas tamb√©m √© um desenvolvedor de software como eu.



Claro, vamos ajustar a view de hist√≥rico m√©dico para seguir o mesmo padr√£o das informa√ß√µes pessoais e adicionar os campos necess√°rios. Tamb√©m vamos incluir os bot√µes "Voltar" e "Pr√≥ximo" com o alinhamento correto.

Aqui est√° o c√≥digo atualizado para a view de hist√≥rico m√©dico:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Hist√≥rico M√©dico
    </div>
    <div class="card-body">
        <form action="/formulario/salvarHistoricoMedico" method="post">
            <div class="form-group">
                <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
                <textarea class="form-control" id="condicoes" name="condicoes"></textarea>
            </div>
            <div class="form-group">
                <label for="alergias">Alergias:</label>
                <textarea class="form-control" id="alergias" name="alergias"></textarea>
            </div>
            <div class="form-group">
                <label for="medicacoes">Medica√ß√µes:</label>
                <textarea class="form-control" id="medicacoes" name="medicacoes"></textarea>
            </div>
            <div class="form-group">
                <label for="cirurgias">Cirurgias:</label>
                <textarea class="form-control" id="cirurgias" name="cirurgias"></textarea>
            </div>
            <div class="form-group">
                <label for="historico_familiar">Hist√≥rico Familiar:</label>
                <textarea class="form-control" id="historico_familiar" name="historico_familiar"></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <a href="/formulario/informacoes_pessoais" class="btn btn-secondary">Voltar</a>
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Explica√ß√£o das Altera√ß√µes:

1. **Estrutura do Formul√°rio**: Adicionei os campos para condi√ß√µes m√©dicas, alergias, medica√ß√µes, cirurgias e hist√≥rico familiar, todos com a classe `form-control` para manter o estilo consistente.
2. **Bot√µes de Navega√ß√£o**: Adicionei um bot√£o "Voltar" que redireciona para a p√°gina de informa√ß√µes pessoais e um bot√£o "Pr√≥ximo" para submeter o formul√°rio. Usei a classe `d-flex justify-content-between` para alinhar os bot√µes corretamente.

### Controller

O controller j√° est√° configurado corretamente para lidar com a navega√ß√£o entre as etapas. N√£o h√° necessidade de altera√ß√µes adicionais no momento.

Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä


-----------------

o action da view informacoes_pessoais n√£o t√° legal pois est√° apontando para algo que n√£o existe. use os helpers do codeigniter para montar as urls. Ajude-me


Entendi! Vamos ajustar o `action` da view `informacoes_pessoais` para usar os helpers do CodeIgniter e garantir que as URLs estejam corretas.

Aqui est√° o c√≥digo atualizado para a view `informacoes_pessoais`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarInformacoesPessoais') ?>" method="post">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" required>
            </div>
            <div class="form-group">
                <label for="idade">Idade:</label>
                <input type="text" class="form-control" id="idade" name="idade" readonly>
            </div>
            <div class="form-group text-right">
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('data_nascimento').addEventListener('change', function() {
        var dataNascimento = new Date(this.value);
        var hoje = new Date();
        var idade = hoje.getFullYear() - dataNascimento.getFullYear();
        var mes = hoje.getMonth() - dataNascimento.getMonth();
        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });
</script>
<?= $this->endSection() ?>
```

### Explica√ß√£o das Altera√ß√µes:

1. **Uso do Helper `site_url`**: Substitu√≠ o `action` do formul√°rio para usar o helper `site_url('formulario/salvarInformacoesPessoais')`. Isso garante que a URL gerada esteja correta e funcione conforme esperado no ambiente do CodeIgniter.

Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

Fonte: conversa com o Copilot, 11/08/2024
(1) github.com. https://github.com/mauriciopj/SGC/tree/d17a87f41953dec23fbdd1dc160ac18a1948ba79/Codigo_Fonte%2Fapplication%2Fviews%2FUsuarios%2Fcadastro_usuarios.php.
(2) github.com. https://github.com/fmmh10/Pandemic/tree/cd4fd0f5f9c0629d3e1840e1d6bf5b6369add557/ASW%2Fregister.php.
(3) github.com. https://github.com/danfigueiredo/SuriEmu/tree/a3e3b337f4748aa7a3c4c244322aafa78128bec6/tabela_orcamento.php.


---------

A gente tem que fazer alguma altera√ß√£o na view historico_medico e no controller. todos os forms est√£o falando do mesmo registro de paciente no banco. ent√£o eu tenho que conservar o id criado na primeira tela, e temos que alterar o registro com os dados dos campos, n√£o criar um registro novo. entendeu? o que acha? consegue me ajudar?

Entendi perfeitamente! Precisamos garantir que o ID do paciente seja mantido ao longo das etapas do formul√°rio para atualizar o mesmo registro no banco de dados. Vamos fazer as seguintes altera√ß√µes:

1. **Armazenar o ID do Paciente**: Ap√≥s salvar as informa√ß√µes pessoais, redirecionar para a pr√≥xima etapa com o ID do paciente.
2. **Atualizar o Registro Existente**: Nas etapas subsequentes, usar o ID do paciente para atualizar o registro existente.

### Controller Atualizado

Vamos ajustar o controller para armazenar e passar o ID do paciente entre as etapas:

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index()
    {
        return view('formulario/informacoes_pessoais');
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $model->save($data);
        $id = $model->insertID();

        return redirect()->to('/formulario/historico_medico/' . $id);
    }

    public function historicoMedico($id)
    {
        return view('formulario/historico_medico', ['id' => $id]);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to('/formulario/sintomas_atuais/' . $id);
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### View Atualizada para Hist√≥rico M√©dico

Vamos ajustar a view `historico_medico` para incluir o ID do paciente e garantir que os dados sejam enviados corretamente:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Hist√≥rico M√©dico
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarHistoricoMedico/' . $id) ?>" method="post">
            <div class="form-group">
                <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
                <textarea class="form-control" id="condicoes" name="condicoes"></textarea>
            </div>
            <div class="form-group">
                <label for="alergias">Alergias:</label>
                <textarea class="form-control" id="alergias" name="alergias"></textarea>
            </div>
            <div class="form-group">
                <label for="medicacoes">Medica√ß√µes:</label>
                <textarea class="form-control" id="medicacoes" name="medicacoes"></textarea>
            </div>
            <div class="form-group">
                <label for="cirurgias">Cirurgias:</label>
                <textarea class="form-control" id="cirurgias" name="cirurgias"></textarea>
            </div>
            <div class="form-group">
                <label for="historico_familiar">Hist√≥rico Familiar:</label>
                <textarea class="form-control" id="historico_familiar" name="historico_familiar"></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <a href="<?= site_url('formulario/informacoes_pessoais') ?>" class="btn btn-secondary">Voltar</a>
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Explica√ß√£o das Altera√ß√µes:

1. **Controller**:
   - **`salvarInformacoesPessoais`**: Ap√≥s salvar os dados, redireciona para a pr√≥xima etapa com o ID do paciente.
   - **`historicoMedico`**: Recebe o ID do paciente e passa para a view.
   - **`salvarHistoricoMedico`**: Usa o ID do paciente para atualizar o registro existente e redireciona para a pr√≥xima etapa com o ID.

2. **View `historico_medico`**:
   - **Formul√°rio**: Inclui o ID do paciente na URL de a√ß√£o do formul√°rio para garantir que os dados sejam enviados corretamente.

Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä




---------

-------

Eu acabei sendo jogado pra http://localhost/websaraiva/index.php/formulario/historico_medico/1

O que resultou num 404.

O resultado esperado era: http://localhost/websaraiva/formulario/historico_medico/1




Entendi. Parece que o problema est√° relacionado ao uso do `index.php` na URL. Vamos ajustar as configura√ß√µes do CodeIgniter para remover o `index.php` das URLs.

### Passos para Remover `index.php` das URLs

1. **Configura√ß√£o do `.htaccess`**:
   - Certifique-se de que o arquivo `.htaccess` na raiz do seu projeto est√° configurado corretamente. Aqui est√° um exemplo de configura√ß√£o:

```plaintext
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /websaraiva/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php/$1 [L]
</IfModule>
```

2. **Configura√ß√£o do `Config/App.php`**:
   - No arquivo `app/Config/App.php`, defina a propriedade `indexPage` como uma string vazia:

```php
public $indexPage = '';
```

### Ajuste no Controller

Vamos garantir que as URLs geradas no controller estejam corretas:

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index()
    {
        return view('formulario/informacoes_pessoais');
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $model->save($data);
        $id = $model->insertID();

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        return view('formulario/historico_medico', ['id' => $id]);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Ajuste nas Views

Certifique-se de que as URLs nas views tamb√©m est√£o usando o helper `site_url`:

#### View `informacoes_pessoais`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarInformacoesPessoais') ?>" method="post">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" required>
            </div>
            <div class="form-group">
                <label for="idade">Idade:</label>
                <input type="text" class="form-control" id="idade" name="idade" readonly>
            </div>
            <div class="form-group text-right">
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('data_nascimento').addEventListener('change', function() {
        var dataNascimento = new Date(this.value);
        var hoje = new Date();
        var idade = hoje.getFullYear() - dataNascimento.getFullYear();
        var mes = hoje.getMonth() - dataNascimento.getMonth();
        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });
</script>
<?= $this->endSection() ?>
```

#### View `historico_medico`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Hist√≥rico M√©dico
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarHistoricoMedico/' . $id) ?>" method="post">
            <div class="form-group">
                <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
                <textarea class="form-control" id="condicoes" name="condicoes"></textarea>
            </div>
            <div class="form-group">
                <label for="alergias">Alergias:</label>
                <textarea class="form-control" id="alergias" name="alergias"></textarea>
            </div>
            <div class="form-group">
                <label for="medicacoes">Medica√ß√µes:</label>
                <textarea class="form-control" id="medicacoes" name="medicacoes"></textarea>
            </div>
            <div class="form-group">
                <label for="cirurgias">Cirurgias:</label>
                <textarea class="form-control" id="cirurgias" name="cirurgias"></textarea>
            </div>
            <div class="form-group">
                <label for="historico_familiar">Hist√≥rico Familiar:</label>
                <textarea class="form-control" id="historico_familiar" name="historico_familiar"></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <a href="<?= site_url('formulario/informacoes_pessoais') ?>" class="btn btn-secondary">Voltar</a>
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Teste

Ap√≥s fazer essas altera√ß√µes, teste novamente para garantir que as URLs estejam corretas e que o redirecionamento funcione conforme esperado.

Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

Fonte: conversa com o Copilot, 11/08/2024
(1) github.com. https://github.com/mauriciopj/SGC/tree/d17a87f41953dec23fbdd1dc160ac18a1948ba79/Codigo_Fonte%2Fapplication%2Fviews%2FUsuarios%2Fcadastro_usuarios.php.
(2) github.com. https://github.com/fmmh10/Pandemic/tree/cd4fd0f5f9c0629d3e1840e1d6bf5b6369add557/ASW%2Fregister.php.
(3) github.com. https://github.com/danfigueiredo/SuriEmu/tree/a3e3b337f4748aa7a3c4c244322aafa78128bec6/tabela_orcamento.php.

----- 

Vamos verificar alguns pontos que podem estar causando o erro 404:

1. **Rotas Configuradas Corretamente**:
   - Certifique-se de que a rota para `historico_medico` est√° configurada corretamente no arquivo de rotas.

2. **Arquivo `.htaccess`**:
   - Verifique se o arquivo `.htaccess` est√° configurado corretamente para remover o `index.php` das URLs.

3. **M√©todo no Controller**:
   - Certifique-se de que o m√©todo `historicoMedico` no controller est√° recebendo o par√¢metro `$id` corretamente.

Vamos revisar cada um desses pontos.

### Rotas Configuradas Corretamente

Certifique-se de que o arquivo de rotas (`app/Config/Routes.php`) cont√©m a rota correta para `historico_medico`:

```php
$routes->get('/formulario/historico_medico/(:num)', 'FormularioController::historicoMedico/$1');
$routes->post('/formulario/salvarHistoricoMedico/(:num)', 'FormularioController::salvarHistoricoMedico/$1');
```

### Arquivo `.htaccess`

Certifique-se de que o arquivo `.htaccess` na raiz do seu projeto est√° configurado corretamente:

```plaintext
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /websaraiva/
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)$ index.php/$1 [L]
</IfModule>
```

### M√©todo no Controller

Certifique-se de que o m√©todo `historicoMedico` no controller est√° recebendo o par√¢metro `$id` corretamente:

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index()
    {
        return view('formulario/informacoes_pessoais');
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $model->save($data);
        $id = $model->insertID();

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        return view('formulario/historico_medico', ['id' => $id]);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Teste

Ap√≥s verificar e ajustar esses pontos, teste novamente para garantir que a URL `http://localhost/websaraiva/formulario/historico_medico/3` funcione corretamente.

Se ainda estiver enfrentando problemas, por favor, compartilhe mais detalhes sobre a configura√ß√£o do seu projeto para que eu possa ajudar melhor. üòä


----- 

Quando acionamos o bot√£o voltar na tela historico_medico e voltamos para informacoes_pessoais, temos que voltar carregando os dados do paciente que estamos editando. Ajude-me.


Para garantir que os dados do paciente sejam carregados corretamente ao voltar para a tela de informa√ß√µes pessoais, precisamos ajustar o controller para buscar os dados do paciente e pass√°-los para a view. Vamos fazer isso em duas etapas:

1. **Ajustar o Controller**: Modificar os m√©todos para carregar os dados do paciente.
2. **Ajustar as Views**: Modificar as views para exibir os dados carregados.

### Ajuste no Controller

Vamos ajustar o controller para carregar os dados do paciente e pass√°-los para as views:

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index($id = null)
    {
        $model = new PacienteModel();
        $data = [];

        if ($id) {
            $data['paciente'] = $model->find($id);
        }

        return view('formulario/informacoes_pessoais', $data);
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $model->save($data);
        $id = $model->insertID();

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/historico_medico', $data);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Ajuste nas Views

#### View `informacoes_pessoais`:

Vamos ajustar a view `informacoes_pessoais` para exibir os dados carregados:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarInformacoesPessoais') ?>" method="post">
            <input type="hidden" name="id" value="<?= isset($paciente['id']) ? $paciente['id'] : '' ?>">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" value="<?= isset($paciente['nome']) ? $paciente['nome'] : '' ?>" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" value="<?= isset($paciente['data_nascimento']) ? $paciente['data_nascimento'] : '' ?>" required>
            </div>
            <div class="form-group">
                <label for="idade">Idade:</label>
                <input type="text" class="form-control" id="idade" name="idade" value="<?= isset($paciente['data_nascimento']) ? (new DateTime())->diff(new DateTime($paciente['data_nascimento']))->y : '' ?>" readonly>
            </div>
            <div class="form-group text-right">
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('data_nascimento').addEventListener('change', function() {
        var dataNascimento = new Date(this.value);
        var hoje = new Date();
        var idade = hoje.getFullYear() - dataNascimento.getFullYear();
        var mes = hoje.getMonth() - dataNascimento.getMonth();
        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });
</script>
<?= $this->endSection() ?>
```

#### View `historico_medico`:

Vamos ajustar a view `historico_medico` para incluir o ID do paciente e garantir que os dados sejam enviados corretamente:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Hist√≥rico M√©dico
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarHistoricoMedico/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
                <textarea class="form-control" id="condicoes" name="condicoes"><?= isset($paciente['condicoes']) ? $paciente['condicoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="alergias">Alergias:</label>
                <textarea class="form-control" id="alergias" name="alergias"><?= isset($paciente['alergias']) ? $paciente['alergias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="medicacoes">Medica√ß√µes:</label>
                <textarea class="form-control" id="medicacoes" name="medicacoes"><?= isset($paciente['medicacoes']) ? $paciente['medicacoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="cirurgias">Cirurgias:</label>
                <textarea class="form-control" id="cirurgias" name="cirurgias"><?= isset($paciente['cirurgias']) ? $paciente['cirurgias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="historico_familiar">Hist√≥rico Familiar:</label>
                <textarea class="form-control" id="historico_familiar" name="historico_familiar"><?= isset($paciente['historico_familiar']) ? $paciente['historico_familiar'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <a href="<?= site_url('formulario/informacoes_pessoais/' . $paciente['id']) ?>" class="btn btn-secondary">Voltar</a>
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Explica√ß√£o das Altera√ß√µes:

1. **Controller**:
   - **`index`**: Agora aceita um par√¢metro `$id` opcional para carregar os dados do paciente.
   - **`historicoMedico`**: Carrega os dados do paciente e passa para a view.
   - **`salvarInformacoesPessoais`** e **`salvarHistoricoMedico`**: Inclui o ID do paciente nos dados salvos.

2. **Views**:
   - **`informacoes_pessoais`**: Carrega os dados do paciente e preenche os campos do formul√°rio.
   - **`historico_medico`**: Carrega os dados do paciente e preenche os campos do formul√°rio. Inclui o ID do paciente na URL do bot√£o "Voltar".

Com essas altera√ß√µes, ao clicar no bot√£o "Voltar" na tela de hist√≥rico m√©dico, os dados do paciente ser√£o carregados corretamente na tela de informa√ß√µes pessoais. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

Fonte: conversa com o Copilot, 11/08/2024
(1) github.com. https://github.com/danfigueiredo/SuriEmu/tree/a3e3b337f4748aa7a3c4c244322aafa78128bec6/tabela_orcamento.php.


----- 

levou em considera√ß√£o que eu nem sempre tenho o id, se √© um registro novo eu seja, se eu come√ßo pela tela de informacoes pessoais, √© novo, mas se venho do bot√£o voltar √© uma edi√ß√£o. ajude-me

Entendi. Precisamos ajustar o fluxo para lidar com ambos os casos: cria√ß√£o de um novo registro e edi√ß√£o de um registro existente. Vamos garantir que o ID do paciente seja passado corretamente entre as etapas e que os dados sejam carregados quando necess√°rio.

### Ajuste no Controller

Vamos ajustar o controller para lidar com a cria√ß√£o e edi√ß√£o de registros:

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index($id = null)
    {
        $model = new PacienteModel();
        $data = [];

        if ($id) {
            $data['paciente'] = $model->find($id);
        }

        return view('formulario/informacoes_pessoais', $data);
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        
        if (isset($data['id']) && !empty($data['id'])) {
            $model->save($data);
            $id = $data['id'];
        } else {
            $model->save($data);
            $id = $model->insertID();
        }

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/historico_medico', $data);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Ajuste nas Views

#### View `informacoes_pessoais`:

Vamos ajustar a view `informacoes_pessoais` para lidar com a cria√ß√£o e edi√ß√£o de registros:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarInformacoesPessoais') ?>" method="post">
            <input type="hidden" name="id" value="<?= isset($paciente['id']) ? $paciente['id'] : '' ?>">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" value="<?= isset($paciente['nome']) ? $paciente['nome'] : '' ?>" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" value="<?= isset($paciente['data_nascimento']) ? $paciente['data_nascimento'] : '' ?>" required>
            </div>
            <div class="form-group">
                <label for="idade">Idade:</label>
                <input type="text" class="form-control" id="idade" name="idade" value="<?= isset($paciente['data_nascimento']) ? (new DateTime())->diff(new DateTime($paciente['data_nascimento']))->y : '' ?>" readonly>
            </div>
            <div class="form-group text-right">
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('data_nascimento').addEventListener('change', function() {
        var dataNascimento = new Date(this.value);
        var hoje = new Date();
        var idade = hoje.getFullYear() - dataNascimento.getFullYear();
        var mes = hoje.getMonth() - dataNascimento.getMonth();
        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });
</script>
<?= $this->endSection() ?>
```

#### View `historico_medico`:

Vamos ajustar a view `historico_medico` para incluir o ID do paciente e garantir que os dados sejam enviados corretamente:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Hist√≥rico M√©dico
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarHistoricoMedico/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
                <textarea class="form-control" id="condicoes" name="condicoes"><?= isset($paciente['condicoes']) ? $paciente['condicoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="alergias">Alergias:</label>
                <textarea class="form-control" id="alergias" name="alergias"><?= isset($paciente['alergias']) ? $paciente['alergias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="medicacoes">Medica√ß√µes:</label>
                <textarea class="form-control" id="medicacoes" name="medicacoes"><?= isset($paciente['medicacoes']) ? $paciente['medicacoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="cirurgias">Cirurgias:</label>
                <textarea class="form-control" id="cirurgias" name="cirurgias"><?= isset($paciente['cirurgias']) ? $paciente['cirurgias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="historico_familiar">Hist√≥rico Familiar:</label>
                <textarea class="form-control" id="historico_familiar" name="historico_familiar"><?= isset($paciente['historico_familiar']) ? $paciente['historico_familiar'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <a href="<?= site_url('formulario/informacoes_pessoais/' . $paciente['id']) ?>" class="btn btn-secondary">Voltar</a>
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Explica√ß√£o das Altera√ß√µes:

1. **Controller**:
   - **`index`**: Agora aceita um par√¢metro `$id` opcional para carregar os dados do paciente.
   - **`salvarInformacoesPessoais`**: Verifica se o ID est√° presente nos dados do formul√°rio. Se estiver, atualiza o registro existente; caso contr√°rio, cria um novo registro.
   - **`historicoMedico`**: Carrega os dados do paciente e passa para a view.
   - **`salvarHistoricoMedico`**: Usa o ID do paciente para atualizar o registro existente e redireciona para a pr√≥xima etapa com o ID.

2. **Views**:
   - **`informacoes_pessoais`**: Carrega os dados do paciente e preenche os campos do formul√°rio. Inclui um campo oculto para o ID do paciente.
   - **`historico_medico`**: Carrega os dados do paciente e preenche os campos do formul√°rio. Inclui um campo oculto para o ID do paciente e garante que o bot√£o "Voltar" redirecione corretamente.

Com essas altera√ß√µes, o fluxo deve funcionar corretamente tanto para a cria√ß√£o de novos registros quanto para a edi√ß√£o de registros existentes. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

Fonte: conversa com o Copilot, 11/08/2024
(1) github.com. https://github.com/danfigueiredo/SuriEmu/tree/a3e3b337f4748aa7a3c4c244322aafa78128bec6/tabela_orcamento.php.

----- 

mas se podemos ficar indo e voltando a tela de historico_medico precisa de algum ajuste, n√£o precisa? vamos dizer que o usu√°rio avan√ßou para o historico m√©dico, digitou o campo de condi√ßoes m√©dicas, mas por um motivo qualquer voltou pras informa√ß√µes pessoais. o campo digitado tem que ser salvo e na hora que avan√ßar tem que trazer o campo preenchido. entendeu? acha que pode me ajudar?

Entendi perfeitamente. Precisamos garantir que os dados sejam salvos temporariamente quando o usu√°rio navega entre as etapas, para que n√£o sejam perdidos ao voltar para uma etapa anterior. Vamos ajustar o controller e as views para lidar com isso.

### Ajuste no Controller

Vamos ajustar o controller para salvar os dados temporariamente e carreg√°-los corretamente ao voltar para uma etapa anterior:

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index($id = null)
    {
        $model = new PacienteModel();
        $data = [];

        if ($id) {
            $data['paciente'] = $model->find($id);
        }

        return view('formulario/informacoes_pessoais', $data);
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        
        if (isset($data['id']) && !empty($data['id'])) {
            $model->save($data);
            $id = $data['id'];
        } else {
            $model->save($data);
            $id = $model->insertID();
        }

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/historico_medico', $data);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    public function salvarEVoltar($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/informacoes_pessoais/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Ajuste nas Views

#### View `informacoes_pessoais`:

Vamos ajustar a view `informacoes_pessoais` para lidar com a cria√ß√£o e edi√ß√£o de registros:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarInformacoesPessoais') ?>" method="post">
            <input type="hidden" name="id" value="<?= isset($paciente['id']) ? $paciente['id'] : '' ?>">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" value="<?= isset($paciente['nome']) ? $paciente['nome'] : '' ?>" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" value="<?= isset($paciente['data_nascimento']) ? $paciente['data_nascimento'] : '' ?>" required>
            </div>
            <div class="form-group">
                <label for="idade">Idade:</label>
                <input type="text" class="form-control" id="idade" name="idade" value="<?= isset($paciente['data_nascimento']) ? (new DateTime())->diff(new DateTime($paciente['data_nascimento']))->y : '' ?>" readonly>
            </div>
            <div class="form-group text-right">
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('data_nascimento').addEventListener('change', function() {
        var dataNascimento = new Date(this.value);
        var hoje = new Date();
        var idade = hoje.getFullYear() - dataNascimento.getFullYear();
        var mes = hoje.getMonth() - dataNascimento.getMonth();
        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });
</script>
<?= $this->endSection() ?>
```

#### View `historico_medico`:

Vamos ajustar a view `historico_medico` para incluir o ID do paciente e garantir que os dados sejam enviados corretamente:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Hist√≥rico M√©dico
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarHistoricoMedico/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
                <textarea class="form-control" id="condicoes" name="condicoes"><?= isset($paciente['condicoes']) ? $paciente['condicoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="alergias">Alergias:</label>
                <textarea class="form-control" id="alergias" name="alergias"><?= isset($paciente['alergias']) ? $paciente['alergias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="medicacoes">Medica√ß√µes:</label>
                <textarea class="form-control" id="medicacoes" name="medicacoes"><?= isset($paciente['medicacoes']) ? $paciente['medicacoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="cirurgias">Cirurgias:</label>
                <textarea class="form-control" id="cirurgias" name="cirurgias"><?= isset($paciente['cirurgias']) ? $paciente['cirurgias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="historico_familiar">Hist√≥rico Familiar:</label>
                <textarea class="form-control" id="historico_familiar" name="historico_familiar"><?= isset($paciente['historico_familiar']) ? $paciente['historico_familiar'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <a href="<?= site_url('formulario/salvarEVoltar/' . $paciente['id']) ?>" class="btn btn-secondary">Voltar</a>
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Explica√ß√£o das Altera√ß√µes:

1. **Controller**:
   - **`salvarEVoltar`**: Novo m√©todo para salvar os dados temporariamente e redirecionar para a tela de informa√ß√µes pessoais.
   - **`index`**: Agora aceita um par√¢metro `$id` opcional para carregar os dados do paciente.
   - **`salvarInformacoesPessoais`**: Verifica se o ID est√° presente nos dados do formul√°rio. Se estiver, atualiza o registro existente; caso contr√°rio, cria um novo registro.
   - **`historicoMedico`**: Carrega os dados do paciente e passa para a view.
   - **`salvarHistoricoMedico`**: Usa o ID do paciente para atualizar o registro existente e redireciona para a pr√≥xima etapa com o ID.

2. **Views**:
   - **`informacoes_pessoais`**: Carrega os dados do paciente e preenche os campos do formul√°rio. Inclui um campo oculto para o ID do paciente.
   - **`historico_medico`**: Carrega os dados do paciente e preenche os campos do formul√°rio. Inclui um campo oculto para o ID do paciente e garante que o bot√£o "Voltar" redirecione corretamente.

Com essas altera√ß√µes, os dados ser√£o salvos temporariamente ao navegar entre as etapas, garantindo que n√£o sejam perdidos ao voltar para uma etapa anterior. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

Fonte: conversa com o Copilot, 11/08/2024
(1) github.com. https://github.com/danfigueiredo/SuriEmu/tree/a3e3b337f4748aa7a3c4c244322aafa78128bec6/tabela_orcamento.php.


----- 

Whoops!
We seem to have hit a snag. Please try again later...


Parece que houve um problema. Vamos tentar resolver isso juntos. Aqui est√£o algumas coisas que podemos verificar:

1. **Logs de Erro**:
   - Verifique os logs de erro do CodeIgniter para obter mais detalhes sobre o problema. Eles geralmente est√£o localizados em `writable/logs/`.

2. **Configura√ß√£o do Ambiente**:
   - Certifique-se de que o ambiente de desenvolvimento est√° configurado corretamente. Verifique o arquivo `.env` para garantir que as configura√ß√µes est√£o corretas.

3. **Rotas**:
   - Certifique-se de que as rotas est√£o configuradas corretamente no arquivo `app/Config/Routes.php`.

4. **Permiss√µes**:
   - Verifique as permiss√µes das pastas e arquivos, especialmente a pasta `writable`.

Vamos revisar as rotas e o controller novamente para garantir que tudo esteja correto.

### Rotas

Certifique-se de que as rotas no arquivo `app/Config/Routes.php` est√£o configuradas assim:

```php
$routes->get('/', 'Home::index');

$routes->get('/formulario', 'FormularioController::index');
$routes->get('/formulario/informacoes_pessoais/(:num)', 'FormularioController::index/$1');
$routes->post('/formulario/salvarInformacoesPessoais', 'FormularioController::salvarInformacoesPessoais');
$routes->get('/formulario/historico_medico/(:num)', 'FormularioController::historicoMedico/$1');
$routes->post('/formulario/salvarHistoricoMedico/(:num)', 'FormularioController::salvarHistoricoMedico/$1');
$routes->get('/formulario/salvarEVoltar/(:num)', 'FormularioController::salvarEVoltar/$1');
// Continue adicionando rotas para as outras etapas...
```

### Controller

Certifique-se de que o controller `FormularioController` est√° assim:

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index($id = null)
    {
        $model = new PacienteModel();
        $data = [];

        if ($id) {
            $data['paciente'] = $model->find($id);
        }

        return view('formulario/informacoes_pessoais', $data);
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        
        if (isset($data['id']) && !empty($data['id'])) {
            $model->save($data);
            $id = $data['id'];
        } else {
            $model->save($data);
            $id = $model->insertID();
        }

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/historico_medico', $data);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    public function salvarEVoltar($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/informacoes_pessoais/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Views

#### View `informacoes_pessoais`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Informa√ß√µes Pessoais
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarInformacoesPessoais') ?>" method="post">
            <input type="hidden" name="id" value="<?= isset($paciente['id']) ? $paciente['id'] : '' ?>">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" class="form-control" id="nome" name="nome" value="<?= isset($paciente['nome']) ? $paciente['nome'] : '' ?>" required>
            </div>
            <div class="form-group">
                <label for="data_nascimento">Data de Nascimento:</label>
                <input type="date" class="form-control" id="data_nascimento" name="data_nascimento" value="<?= isset($paciente['data_nascimento']) ? $paciente['data_nascimento'] : '' ?>" required>
            </div>
            <div class="form-group">
                <label for="idade">Idade:</label>
                <input type="text" class="form-control" id="idade" name="idade" value="<?= isset($paciente['data_nascimento']) ? (new DateTime())->diff(new DateTime($paciente['data_nascimento']))->y : '' ?>" readonly>
            </div>
            <div class="form-group text-right">
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.getElementById('data_nascimento').addEventListener('change', function() {
        var dataNascimento = new Date(this.value);
        var hoje = new Date();
        var idade = hoje.getFullYear() - dataNascimento.getFullYear();
        var mes = hoje.getMonth() - dataNascimento.getMonth();
        if (mes < 0 || (mes === 0 && hoje.getDate() < dataNascimento.getDate())) {
            idade--;
        }
        document.getElementById('idade').value = idade;
    });
</script>
<?= $this->endSection() ?>
```

#### View `historico_medico`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Hist√≥rico M√©dico
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarHistoricoMedico/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
                <textarea class="form-control" id="condicoes" name="condicoes"><?= isset($paciente['condicoes']) ? $paciente['condicoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="alergias">Alergias:</label>
                <textarea class="form-control" id="alergias" name="alergias"><?= isset($paciente['alergias']) ? $paciente['alergias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="medicacoes">Medica√ß√µes:</label>
                <textarea class="form-control" id="medicacoes" name="medicacoes"><?= isset($paciente['medicacoes']) ? $paciente['medicacoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="cirurgias">Cirurgias:</label>
                <textarea class="form-control" id="cirurgias" name="cirurgias"><?= isset($paciente['cirurgias']) ? $paciente['cirurgias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="historico_familiar">Hist√≥rico Familiar:</label>
                <textarea class="form-control" id="historico_familiar" name="historico_familiar"><?= isset($paciente['historico_familiar']) ? $paciente['historico_familiar'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <a href="<?= site_url('formulario/salvarEVoltar/' . $paciente['id']) ?>" class="btn btn-secondary">Voltar</a>
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Verifica√ß√£o Final

1. **Verifique os Logs**: Verifique os logs de erro para obter mais detalhes sobre o problema.
2. **Verifique as Permiss√µes**: Certifique-se de que as permiss√µes das pastas e arquivos est√£o corretas.
3. **Teste as Rotas**: Teste as rotas para garantir que est√£o funcionando conforme esperado.

Se ainda estiver enfrentando problemas, por favor, compartilhe mais detalhes sobre a configura√ß√£o do seu projeto para que eu possa ajudar melhor. üòä

Fonte: conversa com o Copilot, 11/08/2024
(1) github.com. https://github.com/danfigueiredo/SuriEmu/tree/a3e3b337f4748aa7a3c4c244322aafa78128bec6/tabela_orcamento.php.

----- 

Aqui est√° o formul√°rio 

<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Hist√≥rico M√©dico
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarHistoricoMedico/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
                <textarea class="form-control" id="condicoes" name="condicoes"><?= isset($paciente['condicoes']) ? $paciente['condicoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="alergias">Alergias:</label>
                <textarea class="form-control" id="alergias" name="alergias"><?= isset($paciente['alergias']) ? $paciente['alergias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="medicacoes">Medica√ß√µes:</label>
                <textarea class="form-control" id="medicacoes" name="medicacoes"><?= isset($paciente['medicacoes']) ? $paciente['medicacoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="cirurgias">Cirurgias:</label>
                <textarea class="form-control" id="cirurgias" name="cirurgias"><?= isset($paciente['cirurgias']) ? $paciente['cirurgias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="historico_familiar">Hist√≥rico Familiar:</label>
                <textarea class="form-control" id="historico_familiar" name="historico_familiar"><?= isset($paciente['historico_familiar']) ? $paciente['historico_familiar'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <a href="<?= site_url('formulario/salvarEVoltar/' . $paciente['id']) ?>" class="btn btn-secondary">Voltar</a>
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>

Aqui o m√©todo executado no controller:

    public function salvarEVoltar($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/informacoes_pessoais/' . $id));
    }

Estou debugando e o $data n√£o est√° tranzendo os dados digitados.

Pode me ajudar?

Claro, vamos resolver isso juntos. O problema parece estar relacionado ao m√©todo HTTP usado pelo bot√£o "Voltar". Atualmente, o bot√£o "Voltar" est√° usando um link (`<a>`), que n√£o envia os dados do formul√°rio. Precisamos mudar isso para um bot√£o que envie os dados do formul√°rio via POST.

### Ajuste na View `historico_medico`

Vamos ajustar a view para que o bot√£o "Voltar" envie os dados do formul√°rio via POST:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Hist√≥rico M√©dico
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarHistoricoMedico/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="condicoes">Condi√ß√µes M√©dicas Preexistentes:</label>
                <textarea class="form-control" id="condicoes" name="condicoes"><?= isset($paciente['condicoes']) ? $paciente['condicoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="alergias">Alergias:</label>
                <textarea class="form-control" id="alergias" name="alergias"><?= isset($paciente['alergias']) ? $paciente['alergias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="medicacoes">Medica√ß√µes:</label>
                <textarea class="form-control" id="medicacoes" name="medicacoes"><?= isset($paciente['medicacoes']) ? $paciente['medicacoes'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="cirurgias">Cirurgias:</label>
                <textarea class="form-control" id="cirurgias" name="cirurgias"><?= isset($paciente['cirurgias']) ? $paciente['cirurgias'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="historico_familiar">Hist√≥rico Familiar:</label>
                <textarea class="form-control" id="historico_familiar" name="historico_familiar"><?= isset($paciente['historico_familiar']) ? $paciente['historico_familiar'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <button type="submit" name="action" value="voltar" class="btn btn-secondary">Voltar</button>
                <button type="submit" name="action" value="proximo" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Ajuste no Controller

Vamos ajustar o m√©todo `salvarHistoricoMedico` no controller para lidar com a a√ß√£o do bot√£o "Voltar":

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index($id = null)
    {
        $model = new PacienteModel();
        $data = [];

        if ($id) {
            $data['paciente'] = $model->find($id);
        }

        return view('formulario/informacoes_pessoais', $data);
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        
        if (isset($data['id']) && !empty($data['id'])) {
            $model->save($data);
            $id = $data['id'];
        } else {
            $model->save($data);
            $id = $model->insertID();
        }

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/historico_medico', $data);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        if ($this->request->getPost('action') === 'voltar') {
            return redirect()->to(site_url('formulario/informacoes_pessoais/' . $id));
        }

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Explica√ß√£o das Altera√ß√µes:

1. **View `historico_medico`**:
   - Substitu√≠ o link "Voltar" por um bot√£o que envia o formul√°rio via POST.
   - Adicionei um atributo `name="action"` aos bot√µes "Voltar" e "Pr√≥ximo" para identificar qual a√ß√£o foi acionada.

2. **Controller**:
   - No m√©todo `salvarHistoricoMedico`, verifiquei qual bot√£o foi acionado (`voltar` ou `proximo`) e redirecionei para a p√°gina apropriada.

Com essas altera√ß√µes, os dados do formul√°rio ser√£o enviados corretamente ao clicar no bot√£o "Voltar", e o campo digitado ser√° salvo e carregado ao voltar para a tela de informa√ß√µes pessoais. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

----- 

Show, tudo est√° funcionando, ent√£o temos uma infra pra seguir adiante...

Vamos para a etapa dos sintomas

   - **Sintomas Atuais**: Sintomas, dura√ß√£o dos sintomas, intensidade dos sintomas, fatores.

Vamos construir a view?

√ìtimo! Vamos construir a view para a etapa dos sintomas atuais. Esta view incluir√° campos para sintomas, dura√ß√£o dos sintomas, intensidade dos sintomas e fatores.

### View `sintomas_atuais`

Aqui est√° o c√≥digo para a view `sintomas_atuais`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Sintomas Atuais
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarSintomasAtuais/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="sintomas">Sintomas:</label>
                <textarea class="form-control" id="sintomas" name="sintomas"><?= isset($paciente['sintomas']) ? $paciente['sintomas'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="duracao_sintomas">Dura√ß√£o dos Sintomas:</label>
                <input type="text" class="form-control" id="duracao_sintomas" name="duracao_sintomas" value="<?= isset($paciente['duracao_sintomas']) ? $paciente['duracao_sintomas'] : '' ?>">
            </div>
            <div class="form-group">
                <label for="intensidade_sintomas">Intensidade dos Sintomas:</label>
                <input type="text" class="form-control" id="intensidade_sintomas" name="intensidade_sintomas" value="<?= isset($paciente['intensidade_sintomas']) ? $paciente['intensidade_sintomas'] : '' ?>">
            </div>
            <div class="form-group">
                <label for="fatores">Fatores:</label>
                <textarea class="form-control" id="fatores" name="fatores"><?= isset($paciente['fatores']) ? $paciente['fatores'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <a href="<?= site_url('formulario/historico_medico/' . $paciente['id']) ?>" class="btn btn-secondary">Voltar</a>
                <button type="submit" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Ajuste no Controller

Vamos adicionar os m√©todos necess√°rios no controller para lidar com a etapa dos sintomas atuais:

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index($id = null)
    {
        $model = new PacienteModel();
        $data = [];

        if ($id) {
            $data['paciente'] = $model->find($id);
        }

        return view('formulario/informacoes_pessoais', $data);
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        
        if (isset($data['id']) && !empty($data['id'])) {
            $model->save($data);
            $id = $data['id'];
        } else {
            $model->save($data);
            $id = $model->insertID();
        }

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/historico_medico', $data);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        if ($this->request->getPost('action') === 'voltar') {
            return redirect()->to(site_url('formulario/informacoes_pessoais/' . $id));
        }

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    public function sintomasAtuais($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/sintomas_atuais', $data);
    }

    public function salvarSintomasAtuais($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        return redirect()->to(site_url('formulario/exames_diagnosticos/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Ajuste nas Rotas

Certifique-se de que as rotas no arquivo `app/Config/Routes.php` est√£o configuradas corretamente:

```php
$routes->get('/', 'Home::index');

$routes->get('/formulario', 'FormularioController::index');
$routes->get('/formulario/informacoes_pessoais/(:num)', 'FormularioController::index/$1');
$routes->post('/formulario/salvarInformacoesPessoais', 'FormularioController::salvarInformacoesPessoais');
$routes->get('/formulario/historico_medico/(:num)', 'FormularioController::historicoMedico/$1');
$routes->post('/formulario/salvarHistoricoMedico/(:num)', 'FormularioController::salvarHistoricoMedico/$1');
$routes->get('/formulario/salvarEVoltar/(:num)', 'FormularioController::salvarEVoltar/$1');
$routes->get('/formulario/sintomas_atuais/(:num)', 'FormularioController::sintomasAtuais/$1');
$routes->post('/formulario/salvarSintomasAtuais/(:num)', 'FormularioController::salvarSintomasAtuais/$1');
// Continue adicionando rotas para as outras etapas...
```

### Explica√ß√£o das Altera√ß√µes:

1. **View `sintomas_atuais`**:
   - Inclui campos para sintomas, dura√ß√£o dos sintomas, intensidade dos sintomas e fatores.
   - Bot√µes "Voltar" e "Pr√≥ximo" para navega√ß√£o entre as etapas.

2. **Controller**:
   - **`sintomasAtuais`**: Carrega os dados do paciente e passa para a view `sintomas_atuais`.
   - **`salvarSintomasAtuais`**: Salva os dados dos sintomas atuais e redireciona para a pr√≥xima etapa.

3. **Rotas**:
   - Adicionadas rotas para carregar e salvar os dados dos sintomas atuais.

Com essas altera√ß√µes, a etapa dos sintomas atuais deve estar pronta. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

----- 

Acho que podemos avan√ßar, vamos √† view:
   - **Exames e Diagn√≥sticos**: Exames, resultados, diagn√≥sticos.

Lembre-se da mecanica do bot√£o voltar:
            <div class="form-group d-flex justify-content-between">
                <button type="submit" name="action" value="voltar" class="btn btn-secondary">Voltar</button>
                <button type="submit" name="action" value="proximo" class="btn btn-primary">Pr√≥ximo</button>
            </div>

Perfeito! Vamos construir a view para a etapa de Exames e Diagn√≥sticos, lembrando da mec√¢nica do bot√£o "Voltar".

### View `exames_diagnosticos`

Aqui est√° o c√≥digo para a view `exames_diagnosticos`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Exames e Diagn√≥sticos
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarExamesDiagnosticos/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="exames">Exames:</label>
                <textarea class="form-control" id="exames" name="exames"><?= isset($paciente['exames']) ? $paciente['exames'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="resultados">Resultados:</label>
                <textarea class="form-control" id="resultados" name="resultados"><?= isset($paciente['resultados']) ? $paciente['resultados'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="diagnosticos">Diagn√≥sticos:</label>
                <textarea class="form-control" id="diagnosticos" name="diagnosticos"><?= isset($paciente['diagnosticos']) ? $paciente['diagnosticos'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <button type="submit" name="action" value="voltar" class="btn btn-secondary">Voltar</button>
                <button type="submit" name="action" value="proximo" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Ajuste no Controller

Vamos adicionar os m√©todos necess√°rios no controller para lidar com a etapa de Exames e Diagn√≥sticos, incluindo a mec√¢nica do bot√£o "Voltar":

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index($id = null)
    {
        $model = new PacienteModel();
        $data = [];

        if ($id) {
            $data['paciente'] = $model->find($id);
        }

        return view('formulario/informacoes_pessoais', $data);
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        
        if (isset($data['id']) && !empty($data['id'])) {
            $model->save($data);
            $id = $data['id'];
        } else {
            $model->save($data);
            $id = $model->insertID();
        }

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/historico_medico', $data);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        if ($this->request->getPost('action') === 'voltar') {
            return redirect()->to(site_url('formulario/informacoes_pessoais/' . $id));
        }

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    public function sintomasAtuais($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/sintomas_atuais', $data);
    }

    public function salvarSintomasAtuais($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        if ($this->request->getPost('action') === 'voltar') {
            return redirect()->to(site_url('formulario/historico_medico/' . $id));
        }

        return redirect()->to(site_url('formulario/exames_diagnosticos/' . $id));
    }

    public function examesDiagnosticos($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/exames_diagnosticos', $data);
    }

    public function salvarExamesDiagnosticos($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        if ($this->request->getPost('action') === 'voltar') {
            return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
        }

        return redirect()->to(site_url('formulario/estilo_vida/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Ajuste nas Rotas

Certifique-se de que as rotas no arquivo `app/Config/Routes.php` est√£o configuradas corretamente:

```php
$routes->get('/', 'Home::index');

$routes->get('/formulario', 'FormularioController::index');
$routes->get('/formulario/informacoes_pessoais/(:num)', 'FormularioController::index/$1');
$routes->post('/formulario/salvarInformacoesPessoais', 'FormularioController::salvarInformacoesPessoais');
$routes->get('/formulario/historico_medico/(:num)', 'FormularioController::historicoMedico/$1');
$routes->post('/formulario/salvarHistoricoMedico/(:num)', 'FormularioController::salvarHistoricoMedico/$1');
$routes->get('/formulario/salvarEVoltar/(:num)', 'FormularioController::salvarEVoltar/$1');
$routes->get('/formulario/sintomas_atuais/(:num)', 'FormularioController::sintomasAtuais/$1');
$routes->post('/formulario/salvarSintomasAtuais/(:num)', 'FormularioController::salvarSintomasAtuais/$1');
$routes->get('/formulario/exames_diagnosticos/(:num)', 'FormularioController::examesDiagnosticos/$1');
$routes->post('/formulario/salvarExamesDiagnosticos/(:num)', 'FormularioController::salvarExamesDiagnosticos/$1');
// Continue adicionando rotas para as outras etapas...
```

### Explica√ß√£o das Altera√ß√µes:

1. **View `exames_diagnosticos`**:
   - Inclui campos para exames, resultados e diagn√≥sticos.
   - Bot√µes "Voltar" e "Pr√≥ximo" para navega√ß√£o entre as etapas, com a mec√¢nica correta para enviar os dados do formul√°rio.

2. **Controller**:
   - **`examesDiagnosticos`**: Carrega os dados do paciente e passa para a view `exames_diagnosticos`.
   - **`salvarExamesDiagnosticos`**: Salva os dados dos exames e diagn√≥sticos e redireciona para a pr√≥xima etapa, ou volta para a etapa anterior se o bot√£o "Voltar" for acionado.

3. **Rotas**:
   - Adicionadas rotas para carregar e salvar os dados dos exames e diagn√≥sticos.

Com essas altera√ß√µes, a etapa de Exames e Diagn√≥sticos deve estar pronta. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

----- 

√ìtimo! Vamos construir a view para a etapa de Estilo de Vida. Esta view incluir√° campos para h√°bitos alimentares, atividade f√≠sica, consumo de √°lcool e tabaco.

### View `estilo_vida`

Aqui est√° o c√≥digo para a view `estilo_vida`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Estilo de Vida
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarEstiloVida/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="habitos_alimentares">H√°bitos Alimentares:</label>
                <textarea class="form-control" id="habitos_alimentares" name="habitos_alimentares"><?= isset($paciente['habitos_alimentares']) ? $paciente['habitos_alimentares'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="atividade_fisica">Atividade F√≠sica:</label>
                <textarea class="form-control" id="atividade_fisica" name="atividade_fisica"><?= isset($paciente['atividade_fisica']) ? $paciente['atividade_fisica'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="alcool">Consumo de √Ålcool:</label>
                <textarea class="form-control" id="alcool" name="alcool"><?= isset($paciente['alcool']) ? $paciente['alcool'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="tabaco">Consumo de Tabaco:</label>
                <textarea class="form-control" id="tabaco" name="tabaco"><?= isset($paciente['tabaco']) ? $paciente['tabaco'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <button type="submit" name="action" value="voltar" class="btn btn-secondary">Voltar</button>
                <button type="submit" name="action" value="proximo" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Ajuste no Controller

Vamos adicionar os m√©todos necess√°rios no controller para lidar com a etapa de Estilo de Vida, incluindo a mec√¢nica do bot√£o "Voltar":

```php
<?php

namespace App\Controllers;

use App\Models\PacienteModel;

class FormularioController extends BaseController
{
    public function index($id = null)
    {
        $model = new PacienteModel();
        $data = [];

        if ($id) {
            $data['paciente'] = $model->find($id);
        }

        return view('formulario/informacoes_pessoais', $data);
    }

    public function salvarInformacoesPessoais()
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        
        if (isset($data['id']) && !empty($data['id'])) {
            $model->save($data);
            $id = $data['id'];
        } else {
            $model->save($data);
            $id = $model->insertID();
        }

        return redirect()->to(site_url('formulario/historico_medico/' . $id));
    }

    public function historicoMedico($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/historico_medico', $data);
    }

    public function salvarHistoricoMedico($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        if ($this->request->getPost('action') === 'voltar') {
            return redirect()->to(site_url('formulario/informacoes_pessoais/' . $id));
        }

        return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
    }

    public function sintomasAtuais($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/sintomas_atuais', $data);
    }

    public function salvarSintomasAtuais($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        if ($this->request->getPost('action') === 'voltar') {
            return redirect()->to(site_url('formulario/historico_medico/' . $id));
        }

        return redirect()->to(site_url('formulario/exames_diagnosticos/' . $id));
    }

    public function examesDiagnosticos($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/exames_diagnosticos', $data);
    }

    public function salvarExamesDiagnosticos($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        if ($this->request->getPost('action') === 'voltar') {
            return redirect()->to(site_url('formulario/sintomas_atuais/' . $id));
        }

        return redirect()->to(site_url('formulario/estilo_vida/' . $id));
    }

    public function estiloVida($id)
    {
        $model = new PacienteModel();
        $data['paciente'] = $model->find($id);

        return view('formulario/estilo_vida', $data);
    }

    public function salvarEstiloVida($id)
    {
        $model = new PacienteModel();
        $data = $this->request->getPost();
        $data['id'] = $id;
        $model->save($data);

        if ($this->request->getPost('action') === 'voltar') {
            return redirect()->to(site_url('formulario/exames_diagnosticos/' . $id));
        }

        return redirect()->to(site_url('formulario/notas_plano_tratamento/' . $id));
    }

    // Continue com os outros m√©todos para cada etapa...
}
```

### Ajuste nas Rotas

Certifique-se de que as rotas no arquivo `app/Config/Routes.php` est√£o configuradas corretamente:

```php
$routes->get('/', 'Home::index');

$routes->get('/formulario', 'FormularioController::index');
$routes->get('/formulario/informacoes_pessoais/(:num)', 'FormularioController::index/$1');
$routes->post('/formulario/salvarInformacoesPessoais', 'FormularioController::salvarInformacoesPessoais');
$routes->get('/formulario/historico_medico/(:num)', 'FormularioController::historicoMedico/$1');
$routes->post('/formulario/salvarHistoricoMedico/(:num)', 'FormularioController::salvarHistoricoMedico/$1');
$routes->get('/formulario/salvarEVoltar/(:num)', 'FormularioController::salvarEVoltar/$1');
$routes->get('/formulario/sintomas_atuais/(:num)', 'FormularioController::sintomasAtuais/$1');
$routes->post('/formulario/salvarSintomasAtuais/(:num)', 'FormularioController::salvarSintomasAtuais/$1');
$routes->get('/formulario/exames_diagnosticos/(:num)', 'FormularioController::examesDiagnosticos/$1');
$routes->post('/formulario/salvarExamesDiagnosticos/(:num)', 'FormularioController::salvarExamesDiagnosticos/$1');
$routes->get('/formulario/estilo_vida/(:num)', 'FormularioController::estiloVida/$1');
$routes->post('/formulario/salvarEstiloVida/(:num)', 'FormularioController::salvarEstiloVida/$1');
// Continue adicionando rotas para as outras etapas...
```

### Explica√ß√£o das Altera√ß√µes:

1. **View `estilo_vida`**:
   - Inclui campos para h√°bitos alimentares, atividade f√≠sica, consumo de √°lcool e tabaco.
   - Bot√µes "Voltar" e "Pr√≥ximo" para navega√ß√£o entre as etapas, com a mec√¢nica correta para enviar os dados do formul√°rio.

2. **Controller**:
   - **`estiloVida`**: Carrega os dados do paciente e passa para a view `estilo_vida`.
   - **`salvarEstiloVida`**: Salva os dados do estilo de vida e redireciona para a pr√≥xima etapa, ou volta para a etapa anterior se o bot√£o "Voltar" for acionado.

3. **Rotas**:
   - Adicionadas rotas para carregar e salvar os dados do estilo de vida.

Com essas altera√ß√µes, a etapa de Estilo de Vida deve estar pronta. Se

----- 

Vamos implementar:

   - **Notas e Plano de Tratamento**: Notas, plano de tratamento, pr√≥ximas consultas, consentimento.

Lembre-se da mecanica do bot√£o voltar:
            <div class="form-group d-flex justify-content-between">
                <button type="submit" name="action" value="voltar" class="btn btn-secondary">Voltar</button>
                <button type="submit" name="action" value="proximo" class="btn btn-primary">Pr√≥ximo</button>
            </div>

No caso do controller, mostre-me apenas os novos m√©todos.
No caso das rotas, mostre-me apenas as novas rotas

Claro! Vamos implementar a etapa de Notas e Plano de Tratamento.

### View `notas_plano_tratamento`

Aqui est√° o c√≥digo para a view `notas_plano_tratamento`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Notas e Plano de Tratamento
    </div>
    <div class="card-body">
        <form action="<?= site_url('formulario/salvarNotasPlanoTratamento/' . $paciente['id']) ?>" method="post">
            <input type="hidden" name="id" value="<?= $paciente['id'] ?>">
            <div class="form-group">
                <label for="notas">Notas:</label>
                <textarea class="form-control" id="notas" name="notas"><?= isset($paciente['notas']) ? $paciente['notas'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="plano_tratamento">Plano de Tratamento:</label>
                <textarea class="form-control" id="plano_tratamento" name="plano_tratamento"><?= isset($paciente['plano_tratamento']) ? $paciente['plano_tratamento'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="proximas_consultas">Pr√≥ximas Consultas:</label>
                <textarea class="form-control" id="proximas_consultas" name="proximas_consultas"><?= isset($paciente['proximas_consultas']) ? $paciente['proximas_consultas'] : '' ?></textarea>
            </div>
            <div class="form-group">
                <label for="consentimento">Consentimento:</label>
                <textarea class="form-control" id="consentimento" name="consentimento"><?= isset($paciente['consentimento']) ? $paciente['consentimento'] : '' ?></textarea>
            </div>
            <div class="form-group d-flex justify-content-between">
                <button type="submit" name="action" value="voltar" class="btn btn-secondary">Voltar</button>
                <button type="submit" name="action" value="proximo" class="btn btn-primary">Pr√≥ximo</button>
            </div>
        </form>
    </div>
</div>
<?= $this->endSection() ?>
```

### Novos M√©todos no Controller

Aqui est√£o os novos m√©todos no controller para lidar com a etapa de Notas e Plano de Tratamento:

```php
public function notasPlanoTratamento($id)
{
    $model = new PacienteModel();
    $data['paciente'] = $model->find($id);

    return view('formulario/notas_plano_tratamento', $data);
}

public function salvarNotasPlanoTratamento($id)
{
    $model = new PacienteModel();
    $data = $this->request->getPost();
    $data['id'] = $id;
    $model->save($data);

    if ($this->request->getPost('action') === 'voltar') {
        return redirect()->to(site_url('formulario/estilo_vida/' . $id));
    }

    // Redirecionar para a pr√≥xima etapa ou p√°gina final
    return redirect()->to(site_url('formulario/final/' . $id));
}
```

### Novas Rotas

Aqui est√£o as novas rotas no arquivo `app/Config/Routes.php`:

```php
$routes->get('/formulario/notas_plano_tratamento/(:num)', 'FormularioController::notasPlanoTratamento/$1');
$routes->post('/formulario/salvarNotasPlanoTratamento/(:num)', 'FormularioController::salvarNotasPlanoTratamento/$1');
```

### Explica√ß√£o das Altera√ß√µes:

1. **View `notas_plano_tratamento`**:
   - Inclui campos para notas, plano de tratamento, pr√≥ximas consultas e consentimento.
   - Bot√µes "Voltar" e "Pr√≥ximo" para navega√ß√£o entre as etapas, com a mec√¢nica correta para enviar os dados do formul√°rio.

2. **Controller**:
   - **`notasPlanoTratamento`**: Carrega os dados do paciente e passa para a view `notas_plano_tratamento`.
   - **`salvarNotasPlanoTratamento`**: Salva os dados das notas e plano de tratamento e redireciona para a pr√≥xima etapa, ou volta para a etapa anterior se o bot√£o "Voltar" for acionado.

3. **Rotas**:
   - Adicionadas rotas para carregar e salvar os dados das notas e plano de tratamento.

Com essas altera√ß√µes, a etapa de Notas e Plano de Tratamento deve estar pronta. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

----- 

N√£o pensei no final direito... O que voc√™ sugere?

Para finalizar o fluxo do formul√°rio, podemos criar uma p√°gina de confirma√ß√£o ou resumo onde o usu√°rio pode revisar todas as informa√ß√µes inseridas antes de finalizar o processo. Isso ajuda a garantir que todos os dados estejam corretos e permite ao usu√°rio fazer ajustes finais, se necess√°rio.

### P√°gina de Confirma√ß√£o

Vamos criar uma view de confirma√ß√£o que exibe todas as informa√ß√µes coletadas e permite ao usu√°rio confirmar ou voltar para editar qualquer etapa.

#### View `confirmacao`

Aqui est√° o c√≥digo para a view `confirmacao`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Confirma√ß√£o
    </div>
    <div class="card-body">
        <h5>Informa√ß√µes Pessoais</h5>
        <p><strong>Nome:</strong> <?= $paciente['nome'] ?></p>
        <p><strong>Data de Nascimento:</strong> <?= $paciente['data_nascimento'] ?></p>
        <p><strong>Idade:</strong> <?= (new DateTime())->diff(new DateTime($paciente['data_nascimento']))->y ?></p>

        <h5>Hist√≥rico M√©dico</h5>
        <p><strong>Condi√ß√µes M√©dicas Preexistentes:</strong> <?= $paciente['condicoes'] ?></p>
        <p><strong>Alergias:</strong> <?= $paciente['alergias'] ?></p>
        <p><strong>Medica√ß√µes:</strong> <?= $paciente['medicacoes'] ?></p>
        <p><strong>Cirurgias:</strong> <?= $paciente['cirurgias'] ?></p>
        <p><strong>Hist√≥rico Familiar:</strong> <?= $paciente['historico_familiar'] ?></p>

        <h5>Sintomas Atuais</h5>
        <p><strong>Sintomas:</strong> <?= $paciente['sintomas'] ?></p>
        <p><strong>Dura√ß√£o dos Sintomas:</strong> <?= $paciente['duracao_sintomas'] ?></p>
        <p><strong>Intensidade dos Sintomas:</strong> <?= $paciente['intensidade_sintomas'] ?></p>
        <p><strong>Fatores:</strong> <?= $paciente['fatores'] ?></p>

        <h5>Exames e Diagn√≥sticos</h5>
        <p><strong>Exames:</strong> <?= $paciente['exames'] ?></p>
        <p><strong>Resultados:</strong> <?= $paciente['resultados'] ?></p>
        <p><strong>Diagn√≥sticos:</strong> <?= $paciente['diagnosticos'] ?></p>

        <h5>Estilo de Vida</h5>
        <p><strong>H√°bitos Alimentares:</strong> <?= $paciente['habitos_alimentares'] ?></p>
        <p><strong>Atividade F√≠sica:</strong> <?= $paciente['atividade_fisica'] ?></p>
        <p><strong>Consumo de √Ålcool:</strong> <?= $paciente['alcool'] ?></p>
        <p><strong>Consumo de Tabaco:</strong> <?= $paciente['tabaco'] ?></p>

        <h5>Notas e Plano de Tratamento</h5>
        <p><strong>Notas:</strong> <?= $paciente['notas'] ?></p>
        <p><strong>Plano de Tratamento:</strong> <?= $paciente['plano_tratamento'] ?></p>
        <p><strong>Pr√≥ximas Consultas:</strong> <?= $paciente['proximas_consultas'] ?></p>
        <p><strong>Consentimento:</strong> <?= $paciente['consentimento'] ?></p>

        <div class="form-group d-flex justify-content-between">
            <a href="<?= site_url('formulario/notas_plano_tratamento/' . $paciente['id']) ?>" class="btn btn-secondary">Voltar</a>
            <a href="<?= site_url('formulario/finalizar/' . $paciente['id']) ?>" class="btn btn-primary">Confirmar</a>
        </div>
    </div>
</div>
<?= $this->endSection() ?>
```

### Novos M√©todos no Controller

Aqui est√£o os novos m√©todos no controller para lidar com a p√°gina de confirma√ß√£o e finaliza√ß√£o:

```php
public function confirmacao($id)
{
    $model = new PacienteModel();
    $data['paciente'] = $model->find($id);

    return view('formulario/confirmacao', $data);
}

public function finalizar($id)
{
    // Aqui voc√™ pode adicionar l√≥gica para finalizar o processo, como enviar um e-mail de confirma√ß√£o, gerar um relat√≥rio, etc.
    return redirect()->to(site_url('formulario/sucesso'));
}

public function sucesso()
{
    return view('formulario/sucesso');
}
```

### Novas Rotas

Aqui est√£o as novas rotas no arquivo `app/Config/Routes.php`:

```php
$routes->get('/formulario/confirmacao/(:num)', 'FormularioController::confirmacao/$1');
$routes->get('/formulario/finalizar/(:num)', 'FormularioController::finalizar/$1');
$routes->get('/formulario/sucesso', 'FormularioController::sucesso');
```

### P√°gina de Sucesso

Vamos criar uma p√°gina de sucesso para exibir uma mensagem de confirma√ß√£o ap√≥s a finaliza√ß√£o do processo.

#### View `sucesso`

Aqui est√° o c√≥digo para a view `sucesso`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Sucesso
    </div>
    <div class="card-body">
        <h5>Processo Finalizado com Sucesso!</h5>
        <p>Obrigado por fornecer todas as informa√ß√µes. Seu registro foi conclu√≠do com sucesso.</p>
        <a href="<?= site_url('/') ?>" class="btn btn-primary">Voltar para a P√°gina Inicial</a>
    </div>
</div>
<?= $this->endSection() ?>
```

### Explica√ß√£o das Altera√ß√µes:

1. **View `confirmacao`**:
   - Exibe todas as informa√ß√µes coletadas para revis√£o.
   - Bot√µes "Voltar" para editar informa√ß√µes e "Confirmar" para finalizar o processo.

2. **Controller**:
   - **`confirmacao`**: Carrega os dados do paciente e passa para a view `confirmacao`.
   - **`finalizar`**: Lida com a finaliza√ß√£o do processo e redireciona para a p√°gina de sucesso.
   - **`sucesso`**: Exibe uma mensagem de confirma√ß√£o ap√≥s a finaliza√ß√£o do processo.

3. **Rotas**:
   - Adicionadas rotas para carregar a p√°gina de confirma√ß√£o, finalizar o processo e exibir a p√°gina de sucesso.

Com essas altera√ß√µes, o fluxo do formul√°rio deve estar completo, incluindo uma p√°gina de confirma√ß√£o e uma p√°gina de sucesso. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

----- 
vamos construir uma pagina para listar os pacientes?

Vamos listar apenas o nome, nascimento, idade (tem que ser calculada), e tem que ter um link para as informa√ß√µes pessoais.

Claro! Vamos construir uma p√°gina para listar os pacientes com as informa√ß√µes solicitadas.

### View `listar_pacientes`

Aqui est√° o c√≥digo para a view `listar_pacientes`:

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header">
        Lista de Pacientes
    </div>
    <div class="card-body">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Data de Nascimento</th>
                    <th>Idade</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($pacientes as $paciente): ?>
                    <tr>
                        <td><?= $paciente['nome'] ?></td>
                        <td><?= $paciente['data_nascimento'] ?></td>
                        <td><?= (new DateTime())->diff(new DateTime($paciente['data_nascimento']))->y ?></td>
                        <td>
                            <a href="<?= site_url('formulario/informacoes_pessoais/' . $paciente['id']) ?>" class="btn btn-primary">Ver Informa√ß√µes</a>
                        </td>
                    </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
</div>
<?= $this->endSection() ?>
```

### M√©todo no Controller

Vamos adicionar um m√©todo no controller para carregar a lista de pacientes e passar para a view:

```php
public function listarPacientes()
{
    $model = new PacienteModel();
    $data['pacientes'] = $model->findAll();

    return view('formulario/listar_pacientes', $data);
}
```

### Nova Rota

Aqui est√° a nova rota no arquivo `app/Config/Routes.php`:

```php
$routes->get('/formulario/listar_pacientes', 'FormularioController::listarPacientes');
```

### Explica√ß√£o das Altera√ß√µes:

1. **View `listar_pacientes`**:
   - Exibe uma tabela com o nome, data de nascimento e idade dos pacientes.
   - Inclui um link para visualizar as informa√ß√µes pessoais de cada paciente.

2. **Controller**:
   - **`listarPacientes`**: Carrega a lista de pacientes e passa para a view `listar_pacientes`.

3. **Rota**:
   - Adicionada rota para carregar a p√°gina de listagem de pacientes.

Com essas altera√ß√µes, voc√™ ter√° uma p√°gina para listar os pacientes com as informa√ß√µes solicitadas e um link para visualizar as informa√ß√µes pessoais de cada paciente. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

Fonte: conversa com o Copilot, 11/08/2024
(1) github.com. https://github.com/leopelegrini/codeigniter-clinica-medica/tree/75fdbf3997d711e596e46a413b0db07f5a16081b/app%2FViews%2Fpacientes%2Findex.php.

----- 

Nessa p√°gina vamos colocar um bot√£o "Novo Paciente" que vai para a tela de informa√ß√µes pessoais para cadastro de novo paciente


√ìtima ideia! Vamos adicionar um bot√£o "Novo Paciente" na p√°gina de listagem de pacientes que redireciona para a tela de informa√ß√µes pessoais para cadastrar um novo paciente.

### View `listar_pacientes`

Aqui est√° o c√≥digo atualizado para a view `listar_pacientes` com o bot√£o "Novo Paciente":

```php
<?= $this->extend('layouts/main') ?>

<?= $this->section('content') ?>
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>Lista de Pacientes</span>
        <a href="<?= site_url('formulario/informacoes_pessoais') ?>" class="btn btn-success">Novo Paciente</a>
    </div>
    <div class="card-body">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>Data de Nascimento</th>
                    <th>Idade</th>
                    <th>A√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                <?php foreach ($pacientes as $paciente): ?>
                    <tr>
                        <td><?= $paciente['nome'] ?></td>
                        <td><?= $paciente['data_nascimento'] ?></td>
                        <td><?= (new DateTime())->diff(new DateTime($paciente['data_nascimento']))->y ?></td>
                        <td>
                            <a href="<?= site_url('formulario/informacoes_pessoais/' . $paciente['id']) ?>" class="btn btn-primary">Ver Informa√ß√µes</a>
                        </td>
                    </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>
</div>
<?= $this->endSection() ?>
```

### Explica√ß√£o das Altera√ß√µes:

1. **Bot√£o "Novo Paciente"**:
   - Adicionado um bot√£o "Novo Paciente" na parte superior da p√°gina de listagem de pacientes.
   - O bot√£o redireciona para a tela de informa√ß√µes pessoais para cadastrar um novo paciente.

Com essa altera√ß√£o, a p√°gina de listagem de pacientes agora inclui um bot√£o "Novo Paciente" que facilita o cadastro de novos pacientes. Se precisar de mais alguma coisa ou tiver outras d√∫vidas, estou √† disposi√ß√£o! üòä

----- 

http://localhost/websaraiva/formulario/informacoes_pessoais est√° dando 404